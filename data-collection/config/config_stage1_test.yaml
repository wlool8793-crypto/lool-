# ============================================================================
# IndianKanoon Production Scraper Configuration
# Target: 1.4M+ documents with Google Drive storage
# ============================================================================

# ============================================================================
# URL COLLECTION SETTINGS
# ============================================================================
url_collection:
  base_search_url: "https://indiankanoon.org/search/?formInput=doctype:%20judgments"
  max_pages: null  # null = collect all pages (set to 10 for testing)
  checkpoint_every: 10000  # Save progress every N URLs
  page_load_timeout: 30  # Seconds

# ============================================================================
# SCRAPER SETTINGS
# ============================================================================
scraper:
  # Concurrency (PHASE 4: Optimized for 100 proxies)
  num_threads: 100  # 1:1 mapping with 100 proxies
  batch_size: 1000  # URLs to process per run

  # Rate limiting (seconds) - Per-proxy rate limiting
  delay_between_requests: 0.01  # Very low global delay (rate limiting done per-proxy)

  # Retry settings
  max_retries: 3
  retry_delay: 2  # Initial delay, doubles each retry

  # Timeouts (seconds)
  timeout: 30
  pdf_download_timeout: 120

  # Batch upload
  batch_upload_size: 50  # Upload to Drive every N files

# ============================================================================
# STORAGE SETTINGS
# ============================================================================
storage:
  # Local storage
  temp_dir: "./data/temp_pdfs"

  # Google Drive
  drive_folder_name: "IndianKanoon_PDFs"
  organize_by: "flat"  # Options: flat, court, year

  # Disk management
  min_free_space_gb: 10  # Pause if less than this
  auto_cleanup_after_upload: true

# ============================================================================
# GOOGLE DRIVE SETTINGS
# ============================================================================
google_drive:
  enabled: true
  credentials_file: "./config/credentials.json"
  token_file: "./config/token.pickle"
  batch_size: 50  # Files per batch upload
  max_retries: 3
  retry_delay: 2

# ============================================================================
# DATABASE SETTINGS
# ============================================================================
database:
  # PostgreSQL (PHASE 4: Production scale with async support)
  url: "sqlite:///data/indiankanoon.db"  # Using SQLite for Stage 1 testing

  # SQLite (fallback for development only)
  # url: "sqlite:///data/indiankanoon_production.db"

  pool_size: 20  # Larger pool for 100 workers
  max_overflow: 10
  echo: false  # Set to true for SQL debugging

  # Async database settings (for Phase 4 async migration)
  enable_async: false  # Set to true in Stage 2
  async_pool_min_size: 10
  async_pool_max_size: 20

# ============================================================================
# MONITORING & LOGGING
# ============================================================================
monitoring:
  log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  log_to_file: true
  log_to_console: true
  log_file: "./logs/production_scraper.log"

  # Progress reporting
  progress_interval: 100  # Log progress every N documents
  checkpoint_every: 500  # Save database checkpoint every N documents

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================
performance:
  # Thread pool (PHASE 4: 100 workers for 100 proxies)
  max_workers: 100

  # Connection pooling
  connection_pool_size: 100  # One connection per worker
  connection_keepalive: 30

  # Memory management
  max_queue_size: 1000  # Maximum download queue size
  clear_temp_on_start: false  # Clear temp directory on startup

# ============================================================================
# SAFETY & ERROR HANDLING
# ============================================================================
safety:
  # IP ban protection (PHASE 4: Per-proxy rate limiting)
  max_requests_per_minute: 12000  # 100 proxies × 2 req/sec × 60 = 12000/min
  requests_per_second_per_proxy: 2.0  # Conservative per-proxy limit
  backoff_on_429: true  # Back off if rate limited
  backoff_multiplier: 2

  # Error handling
  max_consecutive_errors: 10  # Stop if too many errors in a row
  skip_after_attempts: 3  # Skip document after N failed attempts

  # Validation
  validate_pdf_header: true  # Check %PDF signature
  min_pdf_size: 1024  # Minimum valid PDF size (bytes)

# ============================================================================
# ESTIMATIONS (for planning)
# ============================================================================
estimations:
  total_documents: 1400000
  average_pdf_size_mb: 0.3  # 300 KB
  total_storage_gb: 420  # 1.4M * 0.3MB

  # Performance estimates (UPDATED FOR PHASE 4)
  docs_per_hour_baseline: 500  # Old baseline (10 workers)
  docs_per_hour_stage1: 5000  # After Stage 1 (100 workers + config)
  docs_per_hour_stage2: 25000  # After Stage 2 (async migration)
  docs_per_hour_stage3: 50000  # After Stage 3 (optimizations)
  docs_per_hour_stage4: 60000  # After Stage 4 (monitoring + integration)
  total_hours_baseline: 2800  # ~117 days at old speed
  total_hours_optimized: 24  # ~1 day at optimized speed (120X improvement)

  # Cost estimates (GCP)
  vm_cost_per_day_usd: 5  # e2-standard-4
  total_cost_usd: 60  # 12 days * $5/day

# ============================================================================
# GCP DEPLOYMENT (for reference)
# ============================================================================
gcp:
  project_id: "YOUR_PROJECT_ID"
  zone: "us-central1-a"

  # VM specifications
  machine_type: "e2-standard-4"  # 4 vCPU, 16 GB RAM
  boot_disk_size_gb: 100
  boot_disk_type: "pd-ssd"

  # Alternative high-performance VM
  # machine_type: "n2-standard-8"  # 8 vCPU, 32 GB RAM (faster but more expensive)

# ============================================================================
# TESTING & DEBUGGING
# ============================================================================
testing:
  test_mode: false
  test_max_documents: 100
  test_max_pages: 10
  skip_drive_upload: false
  verbose_logging: false

# ============================================================================
# PHASE 4: QUALITY ASSURANCE SETTINGS
# ============================================================================
quality:
  # Enable quality gates
  enable_quality_gates: true
  strict_validation: true

  # Quality gate thresholds
  min_overall_quality_score: 0.70  # Accept threshold
  reject_below_quality_score: 0.50  # Reject threshold
  excellent_quality_score: 0.85  # Priority processing

  # Auto-retry on quality failures
  auto_retry_on_quality_failure: true
  max_quality_retries: 2

  # Quality-based routing
  quality_based_prioritization: true

  # Selenium optimization
  use_direct_http_for_pdfs: true  # Skip Selenium for direct PDF links (90% of requests)
  selenium_pool_size: 10  # Reduced from 100 (only for JS-required pages)
